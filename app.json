[{"name":"app.R","content":"# Cargar librerías\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# --- UI (Interfaz de Usuario) ---\nui <- fluidPage(\n  \n  titlePanel(\"Calculadora de Probabilidad\"),\n  \n  sidebarLayout(\n    \n    # --- PANEL IZQUIERDO (Controles) ---\n    sidebarPanel(\n      # 1. Selección de Distribución\n      h4(\"Seleccione una distribución\"),\n      radioButtons(\"dist\", label = NULL,\n                   choices = c(\n                     \"Normal\" = \"norm\",\n                     \"Binomial\" = \"binom\",\n                     \"Poisson\" = \"pois\"\n                   ),\n                   selected = \"norm\"),\n      \n      hr(),\n      \n      # 2. Parámetros (n, p, lambda, mu, sigma)\n      h4(\"Parámetros\"),\n      uiOutput(\"ui_parametros\"),\n      \n      br(), # Espacio vertical\n      \n      # 3. Valor de X (EN CUADRO AZUL, EN LA BARRA LATERAL)\n      div(style = \"background-color: #e8f0fe; padding: 15px; border-radius: 5px; border: 1px solid #aac;\",\n          \n          # Checkbox para activar modo intervalo\n          checkboxInput(\"modo_intervalo\", strong(\"Calcular Intervalo (entre a y b)\"), value = FALSE),\n          \n          # CASO A: Un solo valor\n          conditionalPanel(\n            condition = \"input.modo_intervalo == false\",\n            h4(\"Valor de x\", style = \"border-bottom: 1px solid #aac; padding-bottom: 5px; margin-top: 10px;\"),\n            numericInput(\"valor_x\", \"valor x:\", value = 0)\n          ),\n          \n          # CASO B: Dos valores (Intervalo)\n          conditionalPanel(\n            condition = \"input.modo_intervalo == true\",\n            h4(\"Rango\", style = \"border-bottom: 1px solid #aac; padding-bottom: 5px; margin-top: 10px;\"),\n            fluidRow(\n              column(6, numericInput(\"valor_x1\", \"Desde (a):\", value = -1)),\n              column(6, numericInput(\"valor_x2\", \"Hasta (b):\", value = 1))\n            )\n          )\n      )\n    ),\n    \n    # --- PANEL DERECHO (Gráfico y Resultados) ---\n    mainPanel(\n      # Gráfico\n      plotOutput(\"distPlot\", height = \"400px\"),\n      \n      br(),\n      \n      # Resultados (En cuadro gris)\n      div(style = \"background-color: #f5f5f5; padding: 15px; border-radius: 5px; border: 1px solid #ccc;\",\n          h4(\"Resultados\", style = \"border-bottom: 1px solid #ccc; padding-bottom: 5px;\"),\n          \n          # Salida para MODO PUNTO\n          conditionalPanel(\n            condition = \"input.modo_intervalo == false\",\n            fluidRow(\n              column(4, uiOutput(\"label_le\")), \n              column(8, verbatimTextOutput(\"res_le\", placeholder = TRUE))\n            ),\n            fluidRow(\n              column(4, uiOutput(\"label_ge\")), \n              column(8, verbatimTextOutput(\"res_ge\", placeholder = TRUE))\n            ),\n            fluidRow(\n              column(4, uiOutput(\"label_eq\")), \n              column(8, verbatimTextOutput(\"res_eq\", placeholder = TRUE))\n            )\n          ),\n          \n          # Salida para MODO INTERVALO\n          conditionalPanel(\n            condition = \"input.modo_intervalo == true\",\n            fluidRow(\n              column(4, uiOutput(\"label_int\")), \n              column(8, verbatimTextOutput(\"res_int\", placeholder = TRUE))\n            )\n          )\n      )\n    )\n  )\n)\n\n# --- SERVER (Lógica) ---\nserver <- function(input, output, session) {\n  \n  # 1. Generar Inputs de Parámetros\n  output$ui_parametros <- renderUI({\n    dist <- input$dist\n    \n    if (dist == \"binom\") {\n      tagList(\n        numericInput(\"param1\", \"n (Ensayos):\", value = 10, min = 1, step = 1),\n        numericInput(\"param2\", \"p (Probabilidad de éxito):\", value = 0.5, min = 0, max = 1, step = 0.01)\n      )\n    } else if (dist == \"pois\") {\n      tagList(\n        numericInput(\"param1\", \"Lambda (ℷ):\", value = 5, min = 0, step = 0.1)\n      )\n    } else if (dist == \"norm\") {\n      tagList(\n        numericInput(\"param1\", \"Media (μ):\", value = 0, step = 0.1),\n        numericInput(\"param2\", \"D.E. (σ):\", value = 1, min = 0.001, step = 0.1)\n      )\n    }\n  })\n  \n  # 2. Actualizar valores por defecto\n  observeEvent(input$dist, {\n    val_defecto <- switch(input$dist, \"norm\" = 0, \"binom\" = 5, \"pois\" = 5)\n    updateNumericInput(session, \"valor_x\", value = val_defecto)\n    \n    if(input$dist == \"norm\") {\n      updateNumericInput(session, \"valor_x1\", value = -1)\n      updateNumericInput(session, \"valor_x2\", value = 1)\n    } else {\n      updateNumericInput(session, \"valor_x1\", value = 2)\n      updateNumericInput(session, \"valor_x2\", value = 5)\n    }\n  })\n  \n  # 3. CÁLCULOS\n  calculos <- reactive({\n    req(input$param1)\n    dist <- input$dist\n    p1 <- input$param1\n    p2 <- if (!is.null(input$param2)) input$param2 else NA \n    \n    res <- list(le = NA, ge = NA, eq = NA, int = NA)\n    \n    # --- MODO PUNTO ---\n    if (input$modo_intervalo == FALSE) {\n      x <- input$valor_x\n      \n      if (dist == \"binom\") {\n        res$le <- pbinom(x, size = p1, prob = p2)\n        res$ge <- pbinom(x - 1, size = p1, prob = p2, lower.tail = FALSE) \n        res$eq <- dbinom(x, size = p1, prob = p2)\n      } else if (dist == \"pois\") {\n        res$le <- ppois(x, lambda = p1)\n        res$ge <- ppois(x - 1, lambda = p1, lower.tail = FALSE)\n        res$eq <- dpois(x, lambda = p1)\n      } else if (dist == \"norm\") {\n        res$le <- pnorm(x, mean = p1, sd = p2)\n        res$ge <- pnorm(x, mean = p1, sd = p2, lower.tail = FALSE)\n        # CORRECCIÓN SOLICITADA: P(X=x) es 0\n        res$eq <- 0 \n      }\n      \n      # Caso especial P(X >= 0)\n      if (dist %in% c(\"binom\", \"pois\") && x == 0) res$ge <- 1\n      \n    } \n    # --- MODO INTERVALO ---\n    else {\n      x_a <- min(input$valor_x1, input$valor_x2)\n      x_b <- max(input$valor_x1, input$valor_x2)\n      \n      if (dist == \"norm\") {\n        res$int <- pnorm(x_b, mean = p1, sd = p2) - pnorm(x_a, mean = p1, sd = p2)\n      } else if (dist == \"binom\") {\n        res$int <- pbinom(x_b, size = p1, prob = p2) - pbinom(x_a - 1, size = p1, prob = p2)\n      } else if (dist == \"pois\") {\n        res$int <- ppois(x_b, lambda = p1) - ppois(x_a - 1, lambda = p1)\n      }\n    }\n    return(res)\n  })\n  \n  # 4. GRÁFICO\n  output$distPlot <- renderPlot({\n    req(input$param1) \n    \n    dist <- input$dist\n    p1 <- input$param1\n    p2 <- if (!is.null(input$param2)) input$param2 else NA\n    intervalo <- input$modo_intervalo\n    \n    # Definir límites de sombreado\n    if (!intervalo) {\n      lim_inf <- -Inf\n      lim_sup <- input$valor_x\n    } else {\n      lim_inf <- min(input$valor_x1, input$valor_x2)\n      lim_sup <- max(input$valor_x1, input$valor_x2)\n    }\n    \n    plot_title <- paste(\"Distribución\", switch(dist,\n                                               \"norm\" = paste0(\"Normal (μ=\", round(p1,2), \", σ=\", round(p2,2), \")\"),\n                                               \"binom\" = paste0(\"Binomial (n=\", p1, \", p=\", round(p2,2), \")\"),\n                                               \"pois\" = paste0(\"Poisson (λ=\", round(p1,2), \")\")\n    ))\n    \n    # --- GRÁFICO DISCRETO ---\n    if (dist %in% c(\"binom\", \"pois\")) {\n      x_min <- 0\n      x_max <- if (dist == \"binom\") p1 else max(20, qpois(0.999, lambda = p1) + 1)\n      x_vals <- x_min:x_max\n      \n      probs_df <- data.frame(\n        x = x_vals,\n        prob = if (dist == \"binom\") dbinom(x_vals, size = p1, prob = p2) else dpois(x_vals, lambda = p1)\n      ) %>%\n        mutate(\n          fill_color = if(intervalo) {\n            ifelse(x >= lim_inf & x <= lim_sup, \"salmon\", \"darkcyan\")\n          } else {\n            ifelse(x <= lim_sup, \"salmon\", \"darkcyan\")\n          },\n          x_factor = factor(x, levels = x_vals)\n        )\n      \n      ggplot(probs_df, aes(x = x_factor, y = prob, fill = fill_color)) +\n        geom_col(width = 0.8) +\n        scale_fill_identity() +\n        labs(title = plot_title, x = \"Valor (x)\", y = \"P(X = x)\") +\n        theme_minimal(base_size = 14) +\n        scale_x_discrete(breaks = function(x) {\n          if (length(x) > 30) x[seq(1, length(x), by = 5)]\n          else if (length(x) > 20) x[seq(1, length(x), by = 2)]\n          else x\n        })\n      \n      # --- GRÁFICO CONTINUO ---\n    } else if (dist == \"norm\") {\n      x_min <- p1 - 4 * p2\n      x_max <- p1 + 4 * p2\n      \n      g <- ggplot(data.frame(x = c(x_min, x_max)), aes(x)) +\n        stat_function(fun = dnorm, args = list(mean = p1, sd = p2), color = \"darkcyan\", size = 1) +\n        labs(title = plot_title, x = \"Valor (x)\", y = \"Densidad de Probabilidad\") +\n        theme_minimal(base_size = 14) +\n        ylim(0, NA)\n      \n      shade_min <- if(intervalo) lim_inf else x_min\n      shade_max <- lim_sup\n      shade_min <- max(shade_min, x_min)\n      shade_max <- min(shade_max, x_max)\n      \n      g <- g + stat_function(fun = dnorm, args = list(mean = p1, sd = p2),\n                             xlim = c(shade_min, shade_max),\n                             geom = \"area\", fill = \"salmon\", alpha = 0.7)\n      g\n    }\n  })\n  \n  # 5. ETIQUETAS Y RESULTADOS\n  output$label_le <- renderUI({ strong(paste0(\"P(X \\u2264 \", input$valor_x, \")\")) }) \n  output$label_ge <- renderUI({ strong(paste0(\"P(X \\u2265 \", input$valor_x, \")\")) }) \n  output$label_eq <- renderUI({ strong(paste0(\"P(X = \", input$valor_x, \")\")) })\n  \n  output$label_int <- renderUI({ \n    a <- min(input$valor_x1, input$valor_x2)\n    b <- max(input$valor_x1, input$valor_x2)\n    strong(paste0(\"P(\", a, \" \\u2264 X \\u2264 \", b, \")\")) \n  })\n  \n  output$res_le <- renderText({ format(calculos()$le, digits = 6) })\n  output$res_ge <- renderText({ format(calculos()$ge, digits = 6) })\n  output$res_eq <- renderText({ format(calculos()$eq, digits = 6) })\n  output$res_int <- renderText({ format(calculos()$int, digits = 6) })\n  \n}\n\n# Ejecutar la app\nshinyApp(ui, server)","type":"text"}]
